{% extends "layout.html" %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
  <div class="card shadow-lg p-4" style="width: 100%; max-width: 500px;">
    <div class="d-flex justify-content-center mb-3">
      <div style="background: #f3e5f5; border-radius: 50%; width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px #ce93d8;">
        <i class="bi bi-file-earmark-text" style="font-size:3rem; color:#8e24aa;"></i>
      </div>
    </div>

    <h2 class="fw-bold mb-2 text-center" style="font-size:2rem; color:#8e24aa;">Scan Prescription</h2>
    <div class="mb-3 text-center" style="font-size:1.15rem; color:#333;">Upload or capture a prescription image</div>

    <div id="prescriptionCameraError" class="text-danger text-center mb-2" style="display: none;"></div>

    <!-- ðŸ“· Camera Wrapper -->
    <div class="camera-wrapper mb-3" style="position: relative;">
      <video id="prescriptionVideo" autoplay playsinline
        class="rounded border"
        style="width: 100%; height: auto; aspect-ratio: 3/4; object-fit: cover; background: black;">
      </video>

      <!-- ðŸŸ¦ Overlay dashed frame for guidance -->
      <div class="overlay-frame" style="
        position: absolute;
        top: 10%;
        left: 15%;
        width: 75%;
        height: 70%;
        border: 3px dashed white;
        box-sizing: border-box;
        z-index: 2;
        pointer-events: none;
      "></div>

      <!-- ðŸ”„ Switch Camera Button -->
      <button id="prescriptionSwitchCameraBtn"
        class="btn btn-light btn-sm rounded-circle shadow"
        style="position: absolute; top: 10px; right: 10px; z-index: 3; background-color: rgba(255, 255, 255, 0.85); border: none;">
        ðŸ”„
      </button>
    </div>

    <!-- ðŸ“¸ Capture -->
    <button id="prescriptionCaptureBtn" class="btn btn-outline-dark w-100 mb-3" style="color: #8e24aa;">
      ðŸ“· Capture
    </button>

    <!-- ðŸ“ Outputs -->
    <textarea id="prescriptionTextOutput" class="form-control mb-3" placeholder="Recognized OCR text will appear here..." rows="5" readonly style="display: none;"></textarea>
    <textarea id="prescriptionLLMOutput" class="form-control mb-3" placeholder="Structured response will appear here..." rows="5" readonly style="display: none;"></textarea>

    <!-- ðŸ–¼ï¸ Annotated Image -->
    <div class="mb-3 text-center">
      <img id="prescriptionResultImg" src="" class="w-100 mb-3 rounded border" style="aspect-ratio: 4/3; display: none; cursor: pointer;" alt="Annotated Result">
      <div class="form-text">Annotated Result (Click to Zoom)</div>
    </div>

    <!-- ðŸ“ Upload -->
    <div class="mb-3">
      <label for="prescriptionUploadImage" class="form-label">Or upload a prescription photo</label>
      <input type="file" id="prescriptionUploadImage" class="form-control mb-2" accept="image/*">
      <button id="prescriptionUploadSubmitBtn" class="btn btn-primary w-100 mt-2">ðŸš€ Submit Upload</button>
    </div>
  </div>
</div>

<!-- ðŸ” Zoom Modal -->
<div id="prescriptionImageModal" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.85);">
  <span onclick="document.getElementById('prescriptionImageModal').style.display='none'" style="position:absolute; top:15px; right:25px; font-size:40px; font-weight:bold; color:white; cursor:pointer;">&times;</span>
  <img id="prescriptionZoomedImage" style="max-width:90vw; max-height:90vh; display:block; margin:5% auto; border-radius:12px;">
</div>
{% endblock %}
